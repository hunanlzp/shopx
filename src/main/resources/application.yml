server:
  port: 8080
  servlet:
    context-path: /api
  tomcat:
    threads:
      max: 200
    connection-timeout: 2s

spring:
  application:
    name: shopx-backend
  
  # 数据库配置
  datasource:
    url: jdbc:mysql://localhost:3306/shopx?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=Asia/Shanghai
    username: root
    password: root
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      max-lifetime: 1800000
      validation-timeout: 5000

  # Redis配置
  redis:
    host: localhost
    port: 6379
    password: 
    database: 0
    timeout: 3000
    lettuce:
      pool:
        max-active: 8
        max-wait: -1
        max-idle: 8
        min-idle: 0

  # Redisson配置
  redisson:
    config:
      singleServerConfig:
        address: redis://localhost:6379
        password: 
        database: 0
        connectionMinimumIdleSize: 10
        connectionPoolSize: 64
        idleConnectionTimeout: 10000
        connectTimeout: 10000
        timeout: 3000
        retryAttempts: 3
        retryInterval: 1500

  # 消息队列配置
  rabbitmq:
    host: localhost
    port: 5672
    username: guest
    password: guest
    virtual-host: /
    publisher-confirms: true
    publisher-returns: true
    template:
      mandatory: true
    listener:
      simple:
        acknowledge-mode: auto
        concurrency: 5
        max-concurrency: 10
        prefetch: 1

  # 邮件配置
  mail:
    host: smtp.qq.com
    port: 587
    username: your-email@qq.com
    password: your-email-password
    default-encoding: UTF-8
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
          connectiontimeout: 5000
          timeout: 5000
          writetimeout: 5000

  # 文件上传配置
  servlet:
    multipart:
      enabled: true
      max-file-size: 10MB
      max-request-size: 50MB
      file-size-threshold: 2KB

  # Quartz定时任务配置
  quartz:
    job-store-type: jdbc
    jdbc:
      initialize-schema: never
    properties:
      org:
        quartz:
          scheduler:
            instanceName: ShopXScheduler
            instanceId: AUTO
          jobStore:
            class: org.quartz.impl.jdbcjobstore.JobStoreTX
            driverDelegateClass: org.quartz.impl.jdbcjobstore.StdJDBCDelegate
            tablePrefix: QRTZ_
            isClustered: false
          threadPool:
            class: org.quartz.simpl.SimpleThreadPool
            threadCount: 10
            threadPriority: 5

# MyBatis-Plus配置
mybatis-plus:
  mapper-locations: classpath*:mapper/**/*.xml
  type-aliases-package: com.shopx.entity
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: true
    lazy-loading-enabled: true
    aggressive-lazy-loading: false
  global-config:
    banner: false
    db-config:
      id-type: auto
      logic-delete-value: 1
      logic-not-delete-value: 0

# Swagger/OpenAPI配置
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    operations-sorter: method
  show-actuator: false
  default-consumes-media-type: application/json
  default-produces-media-type: application/json

# 日志配置
logging:
  level:
    root: INFO
    com.shopx: DEBUG
    org.springframework.web: INFO
    org.springframework.security: INFO
    com.baomidou.mybatisplus: WARN
  pattern:
    console: '%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n'
    file: '%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n'
  file:
    name: logs/shopx-backend.log
    max-size: 10MB
    max-history: 7

# Sa-Token配置
sa-token:
  # token名称（同时也是cookie名称）
  token-name: satoken
  # token有效期，单位s 默认30天, -1代表永不过期
  timeout: 2592000
  # token临时有效期 (指定时间内无操作就视为token过期) 单位: 秒
  activity-timeout: -1
  # 是否允许同一账号并发登录 (为true时允许一起登录, 为false时新登录挤掉旧登录)
  is-concurrent: true
  # 在多人登录同一账号时，是否共用一个token (为true时所有登录共用一个token, 为false时每次登录新建一个token)
  is-share: true
  # token风格
  token-style: uuid
  # 是否输出操作日志
  is-log: false
  # JWT秘钥
  jwt-secret-key: shopx-jwt-secret-key-2024
  # Redis配置
  alone-redis:
    # Redis数据库索引
    database: 1
    # Redis服务器地址
    host: localhost
    # Redis服务器连接端口
    port: 6379
    # Redis服务器连接密码（默认为空）
    password: 
    # 连接超时时间
    timeout: 10s

# 监控配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true

# 自定义配置
shopx:
  redis:
    lock-prefix: "shopx:lock:"
    default-timeout: 30
    max-retry-times: 3
  async:
    core-pool-size: 5
    max-pool-size: 20
    queue-capacity: 100
    keep-alive-seconds: 60
    thread-name-prefix: "shopx-async-"
  file-upload:
    upload-path: "./uploads/"
    max-file-size: 10485760  # 10MB
    allowed-types: jpg,jpeg,png,gif,pdf,doc,docx
    enable-compression: true
  business:
    order-timeout: 1800  # 订单超时时间（秒）
    max-cart-items: 100   # 购物车最大商品数
  ai:
    # AI服务配置
    provider: openai  # 可选: openai, claude, custom
    enabled: true
    # OpenAI配置
    openai:
      api-key: ${OPENAI_API_KEY:your-api-key-here}
      api-url: https://api.openai.com/v1/chat/completions
      model: gpt-3.5-turbo
      max-tokens: 1000
      temperature: 0.7
      timeout: 30000
    # Claude配置
    claude:
      api-key: ${CLAUDE_API_KEY:your-api-key-here}
      api-url: https://api.anthropic.com/v1/messages
      model: claude-3-sonnet-20240229
      max-tokens: 1000
    # 自定义AI服务配置
    custom:
      api-url: ${CUSTOM_AI_URL:http://localhost:8000/api/chat}
      api-key: ${CUSTOM_AI_KEY:}
      timeout: 30000
    # 降级策略：如果AI服务不可用，使用本地规则引擎
    fallback-enabled: true